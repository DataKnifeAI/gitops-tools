apiVersion: actions.summerwind.dev/v1alpha1
kind: RunnerDeployment
metadata:
  name: github-runner-deployment
  namespace: managed-cicd
spec:
  # Initial replicas - will be managed by HorizontalRunnerAutoscaler
  replicas: 1
  template:
    spec:
      # Organization-level runner (available to all repos in org)
      # This runner will be available to all projects in the organization
      # NOTE: Runner groups are optional - organization-level runners work without them
      # If you want to use runner groups, create one in GitHub org settings first,
      # then add: runnerGroup: <group-name>
      organization: DataKnifeAI
      
      # Optional: Assign to a runner group for better access control
      # runnerGroup: default
      
      # Alternative: Repository-level runner (attached to a specific repository)
      # repository: <YOUR_GITHUB_ORG>/<YOUR_REPO>
      
      # Alternative: Enterprise-level runner (available across enterprise)
      # enterprise: <YOUR_ENTERPRISE_NAME>
      
      # Runner labels (optional)
      # IMPORTANT: Actions Runner Controller does NOT support multiple labels
      # See: https://docs.github.com/en/actions/how-tos/manage-runners/self-hosted-runners/apply-labels
      # Use only a single label that matches your workflow's runs-on requirement
      labels:
        - self-hosted
      
      # Docker image for runner
      image: summerwind/actions-runner:latest
      
      # Resources for runner pod
      resources:
        requests:
          cpu: 100m
          memory: 128Mi
        limits:
          cpu: "2"  # Use normalized format to match Kubernetes (2000m = 2)
          memory: 4Gi
      
      # Environment variables (optional)
      # Note: RUNNER_NAME is set per-pod by ARC, don't override
      # This allows each runner to have a unique name
      
      # Ephemeral runners - clean up after job completion
      # This ensures runners don't accumulate and prevents replica buildup
      ephemeral: true
      
      # Note: registrationTimeout is not a valid field on RunnerDeployment
      # The timeout is managed by the controller (default 10m)
      # Ephemeral runners will help prevent the buildup issue
