name: Test Self-Hosted Runner

on:
  workflow_dispatch:  # Allows manual triggering
  push:
    branches:
      - main

# Explicit permissions to ensure workflow can run
permissions:
  contents: read
  actions: read

jobs:
  test-runner:
    # Use self-hosted label - must be set via GitHub UI
    # Since v1alpha1 AutoscalingRunnerSet doesn't support labels in spec,
    # labels must be added via GitHub UI:
    # https://github.com/organizations/DataKnifeAI/settings/actions/runner-groups/NRPD Auto Scale
    # Find "nprd-autoscale-runners" → Manage labels → Add "self-hosted"
    runs-on: self-hosted  # Requires "self-hosted" label to be set via GitHub UI
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Display runner info
        run: |
          echo "Runner OS: $(uname -a)"
          echo "Runner hostname: $(hostname)"
          echo "Working directory: $(pwd)"
          echo "Runner labels: ${{ runner.labels }}"
          echo "Runner name: ${{ runner.name }}"
      
      - name: Test basic commands
        run: |
          echo "Testing basic commands..."
          echo "Date: $(date)"
          echo "Uptime: $(uptime)"
          echo "Kubernetes context:"
          kubectl config current-context || echo "kubectl not available"
      
      - name: Test environment
        run: |
          echo "Environment variables:"
          env | grep -E "RUNNER|GITHUB|CI" | sort
      
      - name: Success message
        run: |
          echo "✅ Self-hosted runner is working correctly!"
          echo "Runner successfully executed all test steps."
